From 33cf9baf34b3006d997e951a9cf787fb6a04c450 Mon Sep 17 00:00:00 2001
From: Sabeel Ansari <Sabeel.Ansari@windriver.com>
Date: Wed, 2 Mar 2022 13:09:23 -0500
Subject: [PATCH] Patch for acmesolver-and-chartyaml-cm-v1.7.1

---
 deploy/charts/cert-manager/Chart.yaml         | 20 +++++++++++++++++++
 .../cert-manager/templates/deployment.yaml    |  1 +
 deploy/charts/cert-manager/values.yaml        |  7 +++++++
 3 files changed, 28 insertions(+)
 create mode 100644 deploy/charts/cert-manager/Chart.yaml

diff --git a/deploy/charts/cert-manager/Chart.yaml b/deploy/charts/cert-manager/Chart.yaml
new file mode 100644
index 000000000..d4476fd70
--- /dev/null
+++ b/deploy/charts/cert-manager/Chart.yaml
@@ -0,0 +1,20 @@
+apiVersion: v1
+name: cert-manager
+# The version and appVersion fields are set automatically by the release tool
+version: v1.7.1
+appVersion: v1.7.1
+description: A Helm chart for cert-manager
+home: https://github.com/cert-manager/cert-manager
+icon: https://raw.githubusercontent.com/jetstack/cert-manager/master/logo/logo.png
+keywords:
+  - cert-manager
+  - kube-lego
+  - letsencrypt
+  - tls
+sources:
+  - https://github.com/cert-manager/cert-manager
+maintainers:
+  - name: cert-manager-maintainers
+    email: cert-manager-maintainers@googlegroups.com
+annotations:
+  artifacthub.io/prerelease: "{{IS_PRERELEASE}}"
diff --git a/deploy/charts/cert-manager/templates/deployment.yaml b/deploy/charts/cert-manager/templates/deployment.yaml
index b7f549edc..506fa54aa 100644
--- a/deploy/charts/cert-manager/templates/deployment.yaml
+++ b/deploy/charts/cert-manager/templates/deployment.yaml
@@ -113,6 +113,7 @@ spec:
           {{- if .Values.featureGates }}
           - --feature-gates={{ .Values.featureGates }}
           {{- end }}
+          - --acme-http01-solver-image={{ .Values.acmesolver.image.repository }}:{{ default $.Chart.AppVersion .Values.acmesolver.image.tag }}
           ports:
           - containerPort: 9402
             name: http-metrics
diff --git a/deploy/charts/cert-manager/values.yaml b/deploy/charts/cert-manager/values.yaml
index 44a04db21..a9dca2f97 100644
--- a/deploy/charts/cert-manager/values.yaml
+++ b/deploy/charts/cert-manager/values.yaml
@@ -428,6 +428,13 @@ cainjector:
     # Automount API credentials for a Service Account.
     automountServiceAccountToken: true
 
+acmesolver:
+  image:
+    repository: quay.io/jetstack/cert-manager-acmesolver
+    # Override the image tag to deploy by setting this variable.
+    # If no value is set, the chart's appVersion will be used.
+    # tag: canary
+
 # This startupapicheck is a Helm post-install hook that waits for the webhook
 # endpoints to become available.
 # The check is implemented using a Kubernetes Job- if you are injecting mesh
-- 
2.29.2

